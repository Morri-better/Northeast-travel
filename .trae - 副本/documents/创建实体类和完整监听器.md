# 创建Tour和Product实体类及完整监听器实现计划

## 1. 创建Tour实体类
在 `entity` 包中创建 `Tour.java`，包含旅游团基本信息：
- id（主键）
- name（旅游团名称）
- stock（库存）
- price（价格）
- createdAt/updatedAt（时间戳）

## 2. 创建Product实体类
在 `entity` 包中创建 `Product.java`，包含文创商品基本信息：
- id（主键）
- name（商品名称）
- stock（库存）
- price（价格）
- createdAt/updatedAt（时间戳）

## 3. 创建TourMapper接口
在 `mapper` 包中创建 `TourMapper.java`，继承 `BaseMapper<Tour>`

## 4. 创建ProductMapper接口
在 `mapper` 包中创建 `ProductMapper.java`，继承 `BaseMapper<Product>`

## 5. 更新PaymentSuccessListener监听器
将 [PaymentSuccessListener.java](file:///d:\东北旅游\Northeast-travel\src\main\java\com\example\travelservice\domain\listener\PaymentSuccessListener.java) 更新为完整的扣库存实现：
- 注入 OrderMapper、TourMapper、ProductMapper
- 在事务提交后执行扣库存逻辑
- 按 productType 分发扣库存（TOUR/PRODUCT）
- 使用条件更新防止超卖
- 异常处理：扣库存失败不抛异常，记录日志

## 文件清单
- 新建：`entity/Tour.java`
- 新建：`entity/Product.java`
- 新建：`mapper/TourMapper.java`
- 新建：`mapper/ProductMapper.java`
- 修改：`domain/listener/PaymentSuccessListener.java`